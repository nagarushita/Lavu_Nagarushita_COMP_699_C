{% extends "base.html" %}

{% block title %}Alert Details - Network Monitor{% endblock %}

{% block content %}
<div class="mb-6">
    <div class="flex justify-between items-start">
        <div>
            <h2 class="text-2xl font-bold">Alert #{{ alert.id }}</h2>
            <p class="text-gray-600">{{ alert.rule.name }}</p>
        </div>
        <span class="px-3 py-1 rounded text-sm font-medium
            {% if alert.rule.severity == 'critical' %}bg-red-100 text-red-800
            {% elif alert.rule.severity == 'high' %}bg-orange-100 text-orange-800
            {% elif alert.rule.severity == 'medium' %}bg-yellow-100 text-yellow-800
            {% else %}bg-blue-100 text-blue-800{% endif %}">
            {{ alert.rule.severity }}
        </span>
    </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
    <div class="bg-white p-6 rounded">
        <h3 class="text-lg font-bold mb-4">Alert Information</h3>
        <div class="space-y-3 text-sm">
            <div class="flex justify-between">
                <span class="text-gray-600">Rule:</span>
                <span class="font-medium">{{ alert.rule.name }}</span>
            </div>
            <div class="flex justify-between">
                <span class="text-gray-600">Triggered At:</span>
                <span class="font-medium">{{ alert.triggered_at.strftime('%Y-%m-%d %H:%M:%S') }}</span>
            </div>
            <div class="flex justify-between">
                <span class="text-gray-600">Status:</span>
                <span class="px-2 py-1 rounded text-xs bg-gray-100">{{ alert.status }}</span>
            </div>
            <div class="flex justify-between">
                <span class="text-gray-600">Triggered Value:</span>
                <span class="font-medium">{{ alert.triggered_value }}</span>
            </div>
            {% if alert.resolved_at %}
            <div class="flex justify-between">
                <span class="text-gray-600">Resolved At:</span>
                <span class="font-medium">{{ alert.resolved_at.strftime('%Y-%m-%d %H:%M:%S') }}</span>
            </div>
            {% endif %}
        </div>
    </div>
    
    <div class="bg-white p-6 rounded">
        <h3 class="text-lg font-bold mb-4">Rule Details</h3>
        <div class="space-y-3 text-sm">
            <div class="flex justify-between">
                <span class="text-gray-600">Type:</span>
                <span class="font-medium">{{ alert.rule.rule_type }}</span>
            </div>
            <div class="flex justify-between">
                <span class="text-gray-600">Condition:</span>
                <span class="font-medium">{{ alert.rule.condition }}</span>
            </div>
            <div class="flex justify-between">
                <span class="text-gray-600">Threshold:</span>
                <span class="font-medium">{{ alert.rule.threshold_value }} {{ alert.rule.threshold_unit }}</span>
            </div>
        </div>
    </div>
</div>

<div class="bg-white p-6 rounded mb-6">
    <h3 class="text-lg font-bold mb-4">Details</h3>
    <p class="text-sm text-gray-700">{{ alert.details }}</p>
</div>

{% if alert.status == 'active' %}
<div class="bg-white p-6 rounded">
    <h3 class="text-lg font-bold mb-4">Actions</h3>
    <div class="flex space-x-4">
        <button onclick="acknowledgeAlert()" class="px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700">
            Acknowledge
        </button>
        <button onclick="resolveAlert()" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
            Resolve
        </button>
    </div>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
    function acknowledgeAlert() {
        fetch('/alerts/{{ alert.id }}/acknowledge', {method: 'POST'})
            .then(r => r.json())
            .then(data => location.reload());
    }
    
    function resolveAlert() {
        const notes = prompt('Resolution notes:');
        if (notes) {
            fetch('/alerts/{{ alert.id }}/resolve', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({notes: notes})
            })
            .then(r => r.json())
            .then(data => location.reload());
        }
    }
</script>
{% endblock %}
